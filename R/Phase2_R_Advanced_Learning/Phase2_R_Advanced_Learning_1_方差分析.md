R语言进阶学习（第二阶段）——方差分析
================

- <a href="#8-方差分析" id="toc-8-方差分析">8 方差分析</a>
  - <a href="#81-术语速成" id="toc-81-术语速成">8.1 术语速成</a>
  - <a href="#82-anova模型拟合" id="toc-82-anova模型拟合">8.2
    ANOVA模型拟合</a>
    - <a href="#821-aov函数" id="toc-821-aov函数">8.2.1
      <code>aov()</code>函数</a>
    - <a href="#822-表达式中各项的顺序" id="toc-822-表达式中各项的顺序">8.2.2
      表达式中各项的顺序</a>
  - <a href="#83-单因素方差分析" id="toc-83-单因素方差分析">8.3
    单因素方差分析</a>
    - <a href="#831-多重比较" id="toc-831-多重比较">8.3.1 多重比较</a>
    - <a href="#832-评估检验的假设条件" id="toc-832-评估检验的假设条件">8.3.2
      评估检验的假设条件</a>
  - <a href="#84-单因素协方差分析" id="toc-84-单因素协方差分析">8.4
    单因素协方差分析</a>
    - <a href="#841-评估检验的假设条件" id="toc-841-评估检验的假设条件">8.4.1
      评估检验的假设条件</a>
    - <a href="#842-结果可视化" id="toc-842-结果可视化">8.4.2 结果可视化</a>
  - <a href="#85-双因素方差分析" id="toc-85-双因素方差分析">8.5
    双因素方差分析</a>
  - <a href="#86-重复测量方差分析" id="toc-86-重复测量方差分析">8.6
    重复测量方差分析</a>
  - <a href="#87-多元方差分析" id="toc-87-多元方差分析">8.7 多元方差分析</a>
    - <a href="#871-评估假设检验" id="toc-871-评估假设检验">8.7.1
      评估假设检验</a>
    - <a href="#872-稳健多元方差分析" id="toc-872-稳健多元方差分析">8.7.2
      稳健多元方差分析</a>

Source：

1.  《R语言实战（中文第二版）》

2.  [【B站】从零开始学 R
    语言，带你玩转医学统计学](https://www.bilibili.com/video/BV1JU4y1f7zg/?spm_id_from=333.1007.top_right_bar_window_custom_collection.content.click&vd_source=fa22bae99c47db3f7bc43573bd9b3ed3)

# 8 方差分析

- 本章需要使用car、gplots、HH、rrcov、multcomp、effects、MASS和mvoutlier包。运行后面的代码示例时，请确保已安装以上这些包。

## 8.1 术语速成

- 以焦虑症治疗为例，现有两种治疗方案：认知行为疗法 (CBT)
  和眼动脱敏再加工法 (EMDR)。

- 仅有一个类别型变量的统计设计，称为**单因素方差分析(one-way
  ANOVA)**，或进一步称为单因素组间方差分析。

- 由于在每种治疗方案下观测数相等，因此这种设计也称为均衡设计(balanced
  design)；若观测数不同，则称作非均衡设计(unbalanced design)。

- 当设计包含两个甚至更多的因子时，便是**因素方差分析**设计，比如两因子时称作双因素方差分析，三因子时称作三因素方差分析，以此类推。若因子设计包括组内和组间因子，又称作**混合模型方差分析**，比如，疗法(therapy)和时间(time)都作为因子时，我们既可分析疗法的影响(时间跨度上的平均)和时间的影响(疗法类型跨度上的平均)，又可分析疗法和时间的交互影响，前两个称作**主效应**，交互部分称作**交互效应**，这就是典型的双因素混合模型方差分析。

- 本例将做三次F检验：疗法因素一次，时间因素一次，两者交互因素一次。1、若疗法结果显著，说明CBT和EMDR对焦虑症的治疗效果不同；2、若时间结果显著，说明焦虑度从五周到六个月发生了变化；3、若两者交互效应显著，说明两种疗法随着时间变化对焦虑症治疗影响不同(也就是说，焦虑度从五周到六个月的改变程度在两种疗法间是不同的)。

- 对上面的实验设计稍微做些扩展。已知抑郁症对病症治疗有影响，而且**抑郁症和焦虑症常常同时出现**。抑郁症也可以解释因变量的组间差异，因此它常称为**混淆因素(confounding
  factor)**。由于对抑郁症不感兴趣，因此，它也被称作**干扰变数(nuisance
  variable)**。假设招募患者时使用抑郁症的自我评测报告（白氏抑郁症量表(BDI)）记录了他们的抑郁水平，那么可以在评测疗法类型的影响前，**对任何抑郁水平的组间差异进行统计性调整**。

- 本案例中，BDI为协变量，该设计为**协方差分析(ANCOVA)**。以上设计只记录了单个因变量情况(STAI)，为增强研究的有效性，可以对焦虑症进行其他的测量(比如家庭评分、医师评分,以及焦虑症对日常行为的影响评价)。当因变量不止一个时，设计被称作**多元方差分析(MANOVA)**，若协变量也存在，那么就叫**多元协方差分析(MANCOVA)**。

## 8.2 ANOVA模型拟合

### 8.2.1 `aov()`函数

- `aov()`函数的语法为`aov(formula,data=dataframe)`，下表列举了表达式中可以使用的特殊符号，y是因变量，字母A、B、C代表因子。

  | 符号 | 用法                                                                                                        |
  |------|-------------------------------------------------------------------------------------------------------------|
  | \~   | 分隔符号,左边为响应变量，右边为解释变量。例如，用 A、B 和 C 预测 y，代码为 y \~ A + B + C。                 |
  | :    | 表示变量的交互项。例如，用 A、B 和 A 与 B 的交互项来预测 y，代码为 y \~ A + B + A:B。                       |
  | \*   | 表示所有可能交互项。代码 y \~ A \* B \* C 可展开为 y \~ A + B + C + A:B + A:C + B:C + A:B:。                |
  | ^    | 表示交互项达到某个次数。代码 y \~ (A + B + C)^2 可展开为 y \~ A + B + C + A:B + A:C + B:C。                 |
  | .    | 表示包含除因变量外的所有变量。例如，若一个数据框包含变量 y、A、B 和 C，代码 y \~ .可展开为 y \~ A + B + C。 |

- 下表列举了一些常见的研究设计表达式，小写字母表示定量变量，大写字母表示组别因子，Subject是对被试者独有的标识变量。

  | 设计                                               | 表达式                         |
  |----------------------------------------------------|--------------------------------|
  | 单因素 ANOVA                                       | y \~ A                         |
  | 含单个协变量的单因素 ANCOVA                        | y \~ x + A                     |
  | 双因素 ANOVA                                       | y \~ A \* B                    |
  | 含两个协变量的双因素 ANCOVA                        | y \~ x1 + x2 + A\*B            |
  | 随机化区组                                         | y \~ B + A(B 是区组因子)       |
  | 单因素组内 ANOVA                                   | y \~ A + Error(Subject/A)      |
  | 含单个组内因子(W)和单个组间因子(B)的重复测量 ANOVA | y \~ B \* W + Error(Subject/W) |

### 8.2.2 表达式中各项的顺序

## 8.3 单因素方差分析

### 8.3.1 多重比较

### 8.3.2 评估检验的假设条件

## 8.4 单因素协方差分析

### 8.4.1 评估检验的假设条件

### 8.4.2 结果可视化

## 8.5 双因素方差分析

## 8.6 重复测量方差分析

## 8.7 多元方差分析

### 8.7.1 评估假设检验

### 8.7.2 稳健多元方差分析
